<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEC Contractors - BetterGovPH</title>

    <!-- Google Fonts - Inter -->
    <!-- Tailwind CSS -->
    <link rel="stylesheet" href="/static/css/tailwind.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- BetterGovPH Metadata -->
    <meta name="description" content="SEC Contractors Database - Government Data Analysis Platform">
    <meta name="keywords" content="SEC, contractors, verification, government projects, Philippines, transparency">
    <meta name="author" content="BetterGovPH">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://visualizations.bettergov.ph/contractors">
    <meta property="og:title" content="SEC Contractors - BetterGovPH">
    <meta property="og:description" content="Verify contractor legitimacy through Securities and Exchange Commission registration data">
    <meta property="og:image" content="/static/images/gov_logo.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://visualizations.bettergov.ph/contractors">
    <meta property="twitter:title" content="SEC Contractors - BetterGovPH">
    <meta property="twitter:description" content="Verify contractor legitimacy through Securities and Exchange Commission registration data">
    <meta property="twitter:image" content="/static/images/gov_logo.png">

    <style>
        body {
            font-family: 'Inter', sans-serif !important;
            margin: 0;
            padding: 0;
            background: white !important;
            color: black !important;
            min-height: 100vh;
        }

        /* Mobile responsiveness */
        @media (max-width: 768px) {
            .contractor-title {
                font-size: 2rem;
            }
            
            .contractor-subtitle {
                font-size: 1rem;
            }
            
            .statistics-grid {
                grid-template-columns: 1fr !important;
                gap: 15px !important;
            }
            
            /* Table responsiveness */
            .table-responsive {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            table {
                min-width: 600px;
            }
        }

        /* Pulsing animation for suspicious contractors */
        @keyframes pulse-warning {
            0%, 100% { 
                background-color: #fff3cd; 
                border-color: #ffeaa7;
                transform: scale(1);
            }
            50% { 
                background-color: #ffd93d; 
                border-color: #ffb700;
                transform: scale(1.05);
            }
        }

        .pulse-warning {
            animation: pulse-warning 2s ease-in-out infinite;
        }
    </style>
</head>
<body>

<!-- Navigation -->
<nav class="visualizations-nav py-4 px-6 bg-white border-b border-gray-200">
    <div class="max-w-7xl mx-auto flex items-center justify-between">
        <div class="flex items-center">
            <a href="https://bettergov.ph" class="flex items-center">
                <img src="https://raw.githubusercontent.com/bettergovph/logo/main/png/BetterGov_Horizontal-Black.png"
                     alt="BetterGov.ph"
                     class="h-12 mr-3">
                
            </a>
            <a href="/" class="text-xl font-bold text-black hover:text-gray-600">Data Visualizations</a>
        </div>
        <div class="hidden md:flex space-x-6">
            <a href="/" class="text-black hover:text-gray-600 font-medium transition">Home</a>
            <a href="/nep" class="text-black hover:text-gray-600 font-medium transition">NEP</a>
            <a href="/budget" class="text-black hover:text-gray-600 font-medium transition">Budget</a>
            <a href="/flood" class="text-black hover:text-gray-600 font-medium transition">Flood Control</a>
            <a href="/dime" class="text-black hover:text-gray-600 font-medium transition">DIME</a>
            <a href="/map" class="text-black hover:text-gray-600 font-medium transition">Map</a>
            <a href="/contractors" class="text-black hover:text-gray-600 font-medium transition border-b-2 border-black">Contractors</a>
            <div class="relative" onmouseenter="this.querySelector('.dropdown-menu').classList.remove('hidden')" onmouseleave="this.querySelector('.dropdown-menu').classList.add('hidden')">
                <a href="/correlation" class="text-black hover:text-gray-600 font-medium transition">Correlation ‚ñæ</a>
                <div class="dropdown-menu absolute hidden bg-white shadow-lg rounded-md mt-2 py-2 w-48" style="z-index: 50;">
                    <a href="/budget-nep-correlation" class="block px-4 py-2 text-black hover:bg-gray-100">NEP-Budget</a>
                    <a href="/budget-flood-correlation" class="block px-4 py-2 text-black hover:bg-gray-100">Budget-Flood</a>
                    <a href="/flood-dime-correlation" class="block px-4 py-2 text-black hover:bg-gray-100">Flood-DIME</a>
                </div>
            </div>
        </div>
        <div class="md:hidden">
            <button class="text-black focus:outline-none" onclick="toggleMobileMenu()">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                </svg>
            </button>
        </div>
    </div>
    <!-- Mobile menu (hidden by default) -->
    <div id="mobileMenu" class="hidden mt-4 px-4 space-y-2">
        <a href="/" class="block text-black hover:text-gray-600 font-medium py-2">Home</a>
        <a href="/nep" class="block text-black hover:text-gray-600 font-medium py-2">NEP</a>
        <a href="/budget" class="block text-black hover:text-gray-600 font-medium py-2">Budget</a>
        <a href="/flood" class="block text-black hover:text-gray-600 font-medium py-2">Flood Control</a>
        <a href="/dime" class="block text-black hover:text-gray-600 font-medium py-2">DIME</a>
        <a href="/map" class="block text-black hover:text-gray-600 font-medium py-2">Map</a>
        <a href="/contractors" class="block text-black hover:text-gray-600 font-medium py-2 border-b-2 border-black">Contractors</a>
        <a href="/correlation" class="block text-black hover:text-gray-600 font-medium py-2">Correlation</a>
        <a href="/budget-nep-correlation" class="block text-black hover:text-gray-600 font-medium py-2 pl-4">‚Üí NEP-Budget</a>
        <a href="/budget-flood-correlation" class="block text-black hover:text-gray-600 font-medium py-2 pl-4">‚Üí Budget-Flood</a>
        <a href="/flood-dime-correlation" class="block text-black hover:text-gray-600 font-medium py-2 pl-4">‚Üí Flood-DIME</a>
    </div>
</nav>

<script>
function toggleMobileMenu() {
    const menu = document.getElementById('mobileMenu');
    menu.classList.toggle('hidden');
}
</script>

<!-- Main Content -->
<div style="padding: 6rem;">
<section>
    <div style="max-width: 1400px; margin: 0 auto;">
        
        <!-- SEC Statistics -->
        <div style="background: white; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); padding: 32px; margin-bottom: 32px;">
            <h2 style="font-size: 1.5rem; font-weight: 600; color: black; margin-bottom: 24px;">üìä SEC Data Overview</h2>
            
            <div class="statistics-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 24px;">
                <div style="background: #f9fafb; padding: 24px; border-radius: 8px; text-align: center;">
                    <h3 style="color: #6b7280; font-size: 0.875rem; font-weight: 500; margin-bottom: 8px;">Total Contractors</h3>
                    <p id="total-contractors" style="font-size: 2.5rem; font-weight: 700; color: #2563eb; margin: 0;">Loading...</p>
                    <p style="font-size: 0.75rem; color: #6b7280; margin: 4px 0 0 0;">In system</p>
                </div>
                <div style="background: #f9fafb; padding: 24px; border-radius: 8px; text-align: center;">
                    <h3 style="color: #6b7280; font-size: 0.875rem; font-weight: 500; margin-bottom: 8px;">Processed</h3>
                    <p id="processed-contractors" style="font-size: 2.5rem; font-weight: 700; color: #06b6d4; margin: 0;">Loading...</p>
                    <p style="font-size: 0.75rem; color: #6b7280; margin: 4px 0 0 0;">From scraping</p>
                </div>
                <div style="background: #f0fdf4; padding: 24px; border-radius: 8px; text-align: center; border: 2px solid #bbf7d0;">
                    <h3 style="color: #15803d; font-size: 0.875rem; font-weight: 500; margin-bottom: 8px;">‚úÖ With SEC Data</h3>
                    <p id="with-sec" style="font-size: 2.5rem; font-weight: 700; color: #16a34a; margin: 0;">Loading...</p>
                    <p style="font-size: 0.75rem; color: #16a34a; margin: 4px 0 0 0;">Verified</p>
                </div>
                <div style="background: #fefce8; padding: 24px; border-radius: 8px; text-align: center; border: 2px solid #fde047;">
                    <h3 style="color: #854d0e; font-size: 0.875rem; font-weight: 500; margin-bottom: 8px;">‚ö†Ô∏è NO SEC Results</h3>
                    <p id="suspicious" style="font-size: 2.5rem; font-weight: 700; color: #ca8a04; margin: 0;">Loading...</p>
                    <p style="font-size: 0.75rem; color: #ca8a04; margin: 4px 0 0 0;">Suspicious</p>
                </div>
            </div>
        </div>

        <!-- Contractor Table -->
        <div style="background: white; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); padding: 32px;">
            <h2 style="font-size: 1.5rem; font-weight: 600; color: black; margin-bottom: 24px;">üìã Contractor Database</h2>
            
            <div class="table-responsive" style="overflow-x: auto;">
                <table style="min-width: 100%; border-collapse: collapse;">
                    <thead style="background: #f9fafb;">
                        <tr>
                            <th style="padding: 12px 16px; text-align: left; font-size: 0.75rem; font-weight: 500; color: #6b7280; text-transform: uppercase; letter-spacing: 0.05em; border-bottom: 1px solid #e5e7eb;">#</th>
                            <th style="padding: 12px 16px; text-align: left; font-size: 0.75rem; font-weight: 500; color: #6b7280; text-transform: uppercase; letter-spacing: 0.05em; border-bottom: 1px solid #e5e7eb;">Contractor Name</th>
                            <th style="padding: 12px 16px; text-align: left; font-size: 0.75rem; font-weight: 500; color: #6b7280; text-transform: uppercase; letter-spacing: 0.05em; border-bottom: 1px solid #e5e7eb;">SEC Number</th>
                            <th style="padding: 12px 16px; text-align: left; font-size: 0.75rem; font-weight: 500; color: #6b7280; text-transform: uppercase; letter-spacing: 0.05em; border-bottom: 1px solid #e5e7eb;">Status</th>
                            <th style="padding: 12px 16px; text-align: left; font-size: 0.75rem; font-weight: 500; color: #6b7280; text-transform: uppercase; letter-spacing: 0.05em; border-bottom: 1px solid #e5e7eb;">Address</th>
                        </tr>
                    </thead>
                    <tbody id="contractors-table" style="background: white;">
                        <tr>
                            <td colspan="5" style="padding: 24px; text-align: center; color: #6b7280;">Loading contractors...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        </div>
</div>

<script>
// Load SEC data
async function loadContractors() {
    try {
        const response = await fetch('/static/sec_contractors_database.json');
        const data = await response.json();
        
        // Update statistics
        const summary = data.summary || {};
        document.getElementById('total-contractors').textContent = (summary.total_contractors || 0).toLocaleString();
        document.getElementById('processed-contractors').textContent = (summary.total_contractors || 0).toLocaleString();
        document.getElementById('with-sec').textContent = (summary.with_sec_data || 0).toLocaleString();
        document.getElementById('suspicious').textContent = (summary.suspicious_no_results || 0).toLocaleString();
        
        // Render contractors table
        const contractors = data.contractors || [];
        const tbody = document.getElementById('contractors-table');
        tbody.innerHTML = '';
        
        contractors.forEach((contractor, index) => {
            const row = document.createElement('tr');
            row.style.borderBottom = '1px solid #e5e7eb';
            if (contractor.status === 'NO_SEC_RESULTS') {
                row.style.background = '#fefce8';
            }
            
            const secNumber = contractor.sec_number || '-';
            const status = contractor.status || 'Unknown';
            const address = contractor.registered_address || contractor.address || '-';
            
            const statusBadge = contractor.sec_number && contractor.sec_number.trim() !== '' ? 
                `<span style="padding: 4px 12px; background: #dcfce7; color: #166534; font-size: 0.75rem; border-radius: 9999px; font-weight: 600;">‚úÖ Verified</span>` :
                contractor.status === 'NO_SEC_RESULTS' ?
                `<span class="pulse-warning" style="padding: 4px 12px; background: #fff3cd; color: #854d0e; font-size: 0.75rem; border-radius: 9999px; font-weight: 600; border: 1px solid #fde047;">‚ö†Ô∏è Suspicious</span>` :
                `<span style="padding: 4px 12px; background: #fee2e2; color: #991b1b; font-size: 0.75rem; border-radius: 9999px; font-weight: 600;">‚ùå Missing</span>`;
            
            row.innerHTML = `
                <td style="padding: 16px; font-size: 0.875rem; color: #111827; white-space: nowrap;">${index + 1}</td>
                <td style="padding: 16px; font-size: 0.875rem; font-weight: 500; color: #111827;">${contractor.original_contractor_name || contractor.company_name || contractor.contractor_name}</td>
                <td style="padding: 16px; font-size: 0.875rem; color: #111827; white-space: nowrap;">${secNumber}</td>
                <td style="padding: 16px; font-size: 0.875rem;">${statusBadge}</td>
                <td style="padding: 16px; font-size: 0.875rem; color: #6b7280;">${address.substring(0, 100)}${address.length > 100 ? '...' : ''}</td>
            `;
            
            tbody.appendChild(row);
        });
        
    } catch (error) {
        console.error('Error loading contractors:', error);
        document.getElementById('total-contractors').textContent = 'Error';
        document.getElementById('processed-contractors').textContent = 'Error';
        document.getElementById('with-sec').textContent = 'Error';
        document.getElementById('suspicious').textContent = 'Error';
        
        document.getElementById('contractors-table').innerHTML = `
            <tr>
                <td colspan="5" style="padding: 24px; text-align: center; color: #dc2626;">
                    ‚ùå Error loading contractor data. Please try again later.
                </td>
            </tr>
        `;
    }
}

// Load on page load
loadContractors();
</script>

    </div>
</section>
</div>

{% include "footer.html" %}

</body>
</html>
