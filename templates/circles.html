<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coordinate Circles - Data Quality Analysis | BetterGovPH</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .conspiracy-text {
            font-family: 'Courier New', monospace;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }
        .alien-glow {
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.6);
        }
        .data-grid {
            background: repeating-linear-gradient(
                0deg,
                rgba(255, 255, 255, 0.03) 0px,
                rgba(255, 255, 255, 0.03) 1px,
                transparent 1px,
                transparent 20px
            ),
            repeating-linear-gradient(
                90deg,
                rgba(255, 255, 255, 0.03) 0px,
                rgba(255, 255, 255, 0.03) 1px,
                transparent 1px,
                transparent 20px
            );
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .pulse {
            animation: pulse 2s ease-in-out infinite;
        }
        #map {
            height: 600px;
            border-radius: 12px;
            box-shadow: 0 0 30px rgba(102, 126, 234, 0.8);
        }
        .skewer-line {
            stroke: #ff0000;
            stroke-width: 3;
            stroke-dasharray: 10, 5;
            animation: pulse 2s ease-in-out infinite;
        }
    </style>
</head>
<body class="data-grid">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Header -->
        <div class="text-center mb-12">
            <h1 class="text-5xl font-bold text-white mb-4 conspiracy-text">
                üõ∏ COORDINATE CIRCLES üõ∏
            </h1>
            <p class="text-2xl text-purple-200 mb-2">Data Quality Anomaly Detection</p>
            <p class="text-lg text-purple-300 italic">"The truth is out there... in the database"</p>
        </div>

        <!-- Warning Box -->
        <div class="bg-yellow-500 border-4 border-yellow-600 rounded-lg p-6 mb-8 text-black">
            <h2 class="text-2xl font-bold mb-3">‚ö†Ô∏è UNEXPLAINED PHENOMENON DETECTED</h2>
            <p class="text-lg mb-2">
                Our investigation has uncovered <strong>impossible geometric patterns</strong> in government project coordinates.
            </p>
            <p class="text-base">
                Multiple projects, separated by <strong>20+ kilometers</strong>, share the <strong>EXACT same longitude</strong> - 
                creating perfect vertical alignments that defy geographic probability.
            </p>
        </div>

        <!-- Statistics Cards -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="bg-white bg-opacity-10 backdrop-blur-md rounded-lg p-6 alien-glow">
                <div class="text-4xl mb-2">üéØ</div>
                <div class="text-3xl font-bold text-white" id="total-alignments">Loading...</div>
                <div class="text-purple-200">Vertical Alignments</div>
            </div>
            <div class="bg-white bg-opacity-10 backdrop-blur-md rounded-lg p-6 alien-glow">
                <div class="text-4xl mb-2">üìè</div>
                <div class="text-3xl font-bold text-white" id="max-distance">Loading...</div>
                <div class="text-purple-200">Max Distance (km)</div>
            </div>
            <div class="bg-white bg-opacity-10 backdrop-blur-md rounded-lg p-6 alien-glow">
                <div class="text-4xl mb-2">üî¥</div>
                <div class="text-3xl font-bold text-white" id="affected-projects">Loading...</div>
                <div class="text-purple-200">Affected Projects</div>
            </div>
        </div>

        <!-- Loading Message -->
        <div id="loading" class="text-center text-white text-xl mb-8 pulse">
            üõ∏ Scanning coordinate space for anomalies...
        </div>

        <!-- Results Container -->
        <div id="results" class="hidden">
            <!-- Map Container -->
            <div class="bg-white bg-opacity-10 backdrop-blur-md rounded-lg p-6 mb-8 alien-glow">
                <h2 class="text-2xl font-bold text-white mb-4">üó∫Ô∏è The Skewer Map</h2>
                <p class="text-purple-200 mb-4">
                    Red vertical lines ("skewers") show projects impossibly aligned on the same longitude
                </p>
                <div id="map"></div>
                <div class="mt-4 text-purple-200 text-sm space-y-1">
                    <p><strong>ÔøΩ‰∏≤ Kebab Skewer Visualization:</strong></p>
                    <p>üî¥ Red dashed vertical lines = "Skewers" (same longitude)</p>
                    <p>üü† Colored circles = Projects "skewered" on the same vertical line (like meat on kebab)</p>
                    <p>üìè The longer the skewer, the more impossible the alignment (projects 20+ km apart!)</p>
                </div>
            </div>

            <!-- Top Alignments -->
            <div class="bg-white bg-opacity-10 backdrop-blur-md rounded-lg p-6 mb-8 alien-glow">
                <h2 class="text-2xl font-bold text-white mb-4">üìç Top Impossible Alignments</h2>
                <p class="text-purple-200 mb-4">
                    Projects sharing the same longitude but separated by vast distances
                </p>
                <div id="alignments-list" class="space-y-4">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>

            <!-- Explanation -->
            <div class="bg-white bg-opacity-10 backdrop-blur-md rounded-lg p-6 mb-8">
                <h2 class="text-2xl font-bold text-white mb-4">üî¨ Scientific Analysis</h2>
                <div class="text-purple-100 space-y-3">
                    <p>
                        <strong>What are "Coordinate Circles"?</strong><br>
                        Like crop circles, but in data. These are impossible geometric patterns where multiple government projects 
                        share identical longitude values despite being separated by 10-20+ kilometers.
                    </p>
                    <p>
                        <strong>Why is this impossible?</strong><br>
                        The probability of two projects 20km apart sharing the exact same longitude (to 5-6 decimal places) is 
                        astronomically low - equivalent to winning the lottery multiple times.
                    </p>
                    <p>
                        <strong>What causes this?</strong><br>
                        Unlike crop circles (created by pranksters), coordinate circles are caused by:
                    </p>
                    <ul class="list-disc list-inside ml-4 space-y-1">
                        <li>Low-precision geocoding systems</li>
                        <li>Copy-paste errors in data entry</li>
                        <li>Using municipality/city centers for all projects in that area</li>
                        <li>Coordinate rounding or truncation</li>
                        <li>üõ∏ (Disclaimer: NOT aliens... probably)</li>
                    </ul>
                    <p>
                        <strong>Impact on Data Quality:</strong><br>
                        These anomalies create visual "concentric circles" or "vertically aligned circles" on the map, 
                        making it appear that multiple distinct projects are at the exact same location or on the same vertical line.
                    </p>
                </div>
            </div>

            <!-- Data Quality Recommendations -->
            <div class="bg-red-500 bg-opacity-20 border-2 border-red-400 rounded-lg p-6">
                <h2 class="text-2xl font-bold text-white mb-4">üîß Recommended Actions</h2>
                <div class="text-white space-y-2">
                    <p>‚úÖ Re-geocode affected projects using high-precision geocoding services</p>
                    <p>‚úÖ Implement coordinate validation to detect impossible alignments</p>
                    <p>‚úÖ Use project-specific addresses instead of municipality centers</p>
                    <p>‚úÖ Add coordinate precision requirements (minimum 6 decimal places)</p>
                    <p>‚úÖ Flag projects with duplicate coordinates for manual review</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let map;
        
        function initMap() {
            // Initialize map centered on Philippines
            map = L.map('map').setView([12.8797, 121.7740], 6);
            
            // Add tile layer
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(map);
        }
        
        function drawSkewers(alignments) {
            alignments.forEach((alignment, idx) => {
                const projects = alignment.projects;
                
                // Sort projects by latitude
                const sortedProjects = [...projects].sort((a, b) => a.lat - b.lat);
                
                // Draw vertical line (skewer) from min to max latitude
                const minLat = sortedProjects[0].lat;
                const maxLat = sortedProjects[sortedProjects.length - 1].lat;
                const lng = alignment.longitude;
                
                // Create polyline (the skewer)
                const skewer = L.polyline(
                    [[minLat, lng], [maxLat, lng]],
                    {
                        color: '#ff0000',
                        weight: 3,
                        opacity: 0.8,
                        dashArray: '10, 5',
                        className: 'skewer-line'
                    }
                ).addTo(map);
                
                skewer.bindPopup(`
                    <div style="font-family: monospace;">
                        <strong>üî¥ VERTICAL ALIGNMENT #${idx + 1}</strong><br>
                        <strong>Longitude:</strong> ${lng}<br>
                        <strong>Distance:</strong> ${alignment.distanceKm} km<br>
                        <strong>Projects:</strong> ${alignment.projectCount}
                    </div>
                `);
                
                // Draw circles for each project on the skewer (like meat on a kebab)
                projects.forEach((project, pidx) => {
                    // Vary circle size and color for visual effect
                    const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#ffa07a', '#98d8c8'];
                    const color = colors[pidx % colors.length];
                    
                    const circle = L.circleMarker([project.lat, project.lng || lng], {
                        radius: 8,
                        fillColor: color,
                        color: '#ffffff',
                        weight: 3,
                        opacity: 1,
                        fillOpacity: 0.9
                    }).addTo(map);
                    
                    circle.bindPopup(`
                        <div style="max-width: 300px;">
                            <strong>üî¥ On Skewer #${idx + 1}</strong><br>
                            <strong>${project.city}</strong><br>
                            <em>${project.name}</em><br>
                            <small>Lat: ${project.lat.toFixed(6)}, Lng: ${lng.toFixed(6)}</small><br>
                            <small style="color: #666;">Part of ${alignment.projectCount} projects on this vertical line</small>
                        </div>
                    `);
                });
            });
        }
        
        async function loadAlignmentData() {
            try {
                // Initialize map first
                initMap();
                
                // Fetch flood control projects
                const response = await fetch('https://altgovph.site/api/flood/statistics');
                
                if (!response.ok) {
                    throw new Error('Failed to load data');
                }

                // For now, we'll use mock data based on our analysis
                // TODO: Create a dedicated API endpoint for alignment data
                const mockAlignments = [
                    {
                        longitude: 121.00206,
                        projectCount: 4,
                        latRange: 0.2091,
                        distanceKm: 23.2,
                        projects: [
                            { lat: 14.394145, city: 'LAS PI√ëAS', name: 'Flood Control Structure at Zapote River' },
                            { lat: 14.494381, city: 'PARA√ëAQUE', name: 'Flood Mitigation Structure (Booster Pump)' },
                            { lat: 14.603156, city: 'MANILA', name: 'Additional Booster Pump along Estero de Valencia' },
                            { lat: 14.603226, city: 'MANILA', name: 'Automatic Trash Screen Rake' }
                        ]
                    },
                    {
                        longitude: 121.04407,
                        projectCount: 2,
                        latRange: 0.1885,
                        distanceKm: 20.9,
                        projects: [
                            { lat: 14.581363, city: 'PASIG', name: 'Bank Improvement Pasig-Marikina River' },
                            { lat: 14.769820, city: 'CALOOCAN', name: 'Flood Control Wall along Various Creeks' }
                        ]
                    },
                    {
                        longitude: 120.99407,
                        projectCount: 2,
                        latRange: 0.1629,
                        distanceKm: 18.1,
                        projects: [
                            { lat: 14.418242, city: 'LAS PI√ëAS', name: 'Road and Drainage System Brgy. Talon 5' },
                            { lat: 14.581097, city: 'MANILA', name: 'Pumping Station Apacible Street' }
                        ]
                    },
                    {
                        longitude: 121.01234,
                        projectCount: 2,
                        latRange: 0.1516,
                        distanceKm: 16.8,
                        projects: [
                            { lat: 14.530916, city: 'PASAY', name: 'Slope Protection Maricaban Creek' },
                            { lat: 14.682543, city: 'CALOOCAN', name: 'Flood Control Wall Barangay 163' }
                        ]
                    }
                ];

                // Update statistics
                const totalAlignments = mockAlignments.length;
                const maxDistance = Math.max(...mockAlignments.map(a => a.distanceKm));
                const affectedProjects = mockAlignments.reduce((sum, a) => sum + a.projectCount, 0);

                document.getElementById('total-alignments').textContent = totalAlignments;
                document.getElementById('max-distance').textContent = maxDistance.toFixed(1);
                document.getElementById('affected-projects').textContent = affectedProjects;

                // Draw skewers on map
                drawSkewers(mockAlignments);
                
                // Fit map to show all skewers
                const allCoords = mockAlignments.flatMap(a => 
                    a.projects.map(p => [p.lat, a.longitude])
                );
                if (allCoords.length > 0) {
                    map.fitBounds(allCoords, { padding: [50, 50] });
                }

                // Render alignments
                const alignmentsList = document.getElementById('alignments-list');
                alignmentsList.innerHTML = mockAlignments.map((alignment, idx) => `
                    <div class="bg-black bg-opacity-30 rounded-lg p-4 border border-purple-400">
                        <div class="flex justify-between items-start mb-3">
                            <div>
                                <span class="text-yellow-400 text-xl font-bold">#${idx + 1}</span>
                                <span class="text-white text-lg ml-3">Longitude: ${alignment.longitude}</span>
                            </div>
                            <div class="text-right">
                                <div class="text-red-400 font-bold text-lg">${alignment.distanceKm} km apart</div>
                                <div class="text-purple-300 text-sm">${alignment.projectCount} projects aligned</div>
                            </div>
                        </div>
                        <div class="space-y-2">
                            ${alignment.projects.map(p => `
                                <div class="bg-white bg-opacity-5 rounded p-2 text-sm">
                                    <span class="text-green-400 font-mono">Lat: ${p.lat.toFixed(6)}</span>
                                    <span class="text-purple-200 mx-2">|</span>
                                    <span class="text-blue-300">${p.city}</span>
                                    <span class="text-purple-200 mx-2">|</span>
                                    <span class="text-white">${p.name}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `).join('');

                // Show results
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('results').classList.remove('hidden');

            } catch (error) {
                console.error('Error loading alignment data:', error);
                document.getElementById('loading').innerHTML = '‚ùå Error loading data. Please try again later.';
            }
        }

        // Load data on page load
        loadAlignmentData();
    </script>
</body>
</html>

